---
title: "Helmet Analysis"
output: html_notebook
---

Libraries
```{r}
library(lme4)
library(effectsize)
library(MuMIn)
library(glmnet)
library(lmerTest)
library(car)

```


Import Data
```{r}
data <- read.csv("clean_helmet.csv")
#data <- subset(data, select = -c(chemistry))

data$chemIndex <- as.character(data$chemIndex)
data$porosity <- as.character(data$porosity)
data$sampleNum <- as.character(data$sampleNum)

data <- subset(data, cycleNum <= 10000)
data <- na.omit(data)

# data_stiffness <- subset(data, select = -c(damping, nonlinear))
# data_damping <- subset(data, select = -c(stiffness, nonlinear))
# data_nonlinear <- subset(data, select = -c(damping, stiffness))


```


# Modeling StiffFrac

```{r}

datano0 <- data |>
  subset(cycleNum != 0)
model01 <- lmer(sqrt(stiffFrac) ~ amp + freq + log(cycleNum) + chemIndex +
                 (1|sampleNum), data = datano0)

model1 <- lmer(sqrt(stiffFrac) ~ amp + freq + log(cycleNum) + chemIndex +
                 (1 + log(cycleNum)|sampleNum), data = datano0)

summary(model1)
Anova(model1)

anova(model01, model1)

plot(model1)
res_mm <- residuals(model1)
qqnorm(res_mm)
qqline(res_mm, col='red')

qqnorm(unlist(ranef(model1)))
qqline(res_mm, col='red')

r.squaredGLMM(model1)



```


# Modeling dampFrac
```{r}
model02 <- lmer(dampFrac ~ porosity + freq + amp + strainRate + log(cycleNum) + 
                 (1|sampleNum), data = datano0)

model2 <- lmer(dampFrac ~ porosity + freq + amp + strainRate + log(cycleNum) + 
                 (1 + log(cycleNum)|sampleNum), data = datano0)
summary(model2)
Anova(model2)


plot(model2)
res_mm <- residuals(model2)
qqnorm(res_mm)
qqline(res_mm, col='red')

qqnorm(unlist(ranef(model2)))
qqline(res_mm, col='red')

anova(model20, model2)
r.squaredGLMM(model2)

```


Non-mixed model
```{r}

data10000 <- data |> subset(cycleNum == 10000)


model6 <- lm(sqrt(stiffFrac) ~ chemIndex*porosity + stresskpa + strainRate, 
             data = data10000)
summary(model6)
plot(model6)


model7 <- lm(sqrt(stiffFrac) ~ chemIndex + porosity + stresskpa + strainRate, 
             data = data10000)
summary(model7)
plot(model7)

```


